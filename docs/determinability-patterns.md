# Determinability Patterns: Machinationsフレームワークにおける非決定性要素の具体化

**Concretizing Non-Deterministic Elements in the Machinations Framework**

---

## 概要

Joris Dormans (2012) の「Engineering Emergence: Applied Theory for Game Design」では、ゲーム経済のフィードバックループにおける**決定性（Determinability）**を5つのタイプに分類している（Table 4.2）。しかし、そのうち **Random** のみがダイス記法やランダムゲートとして具体的に実装され、残りの3タイプ（Player Skill, Meta-dynamic, Multiplayer-dynamic）は**アイコン注釈**に留められている。

本ドキュメントでは、この3タイプを既存のMachinationsフレームワーク要素のみで**シミュレーション可能なパターン**として具体化する手法を提示する。

---

## 1. 背景: Dormansの決定性分類

### Table 4.2 Determinability（書籍 p.89）

| タイプ | アイコン | 定義 | Dormansの扱い |
|--------|---------|------|---------------|
| **Deterministic** | (なし) | 同じ状態なら常に同じ結果 | フレームワークの基本動作 |
| **Random** | 🎲 | ランダム要因に依存 | **具体化済み**（D6, ランダムゲート） |
| **Multiplayer-dynamic** | 👥 | プレイヤー間の直接的相互作用 | 注釈のみ |
| **Meta-dynamic** | ♟ | 戦術的・戦略的相互作用 | 注釈のみ |
| **Player Skill** | 👤 | プレイヤーの操作技量 | 注釈のみ |

### 問題点

Dormansは残り3タイプについてこう述べている：

> "player skill is a factor on the operational or tactical level of the game. In games of chance, tactics, or games that involve only deterministic feedback, a whole set of strategic skills can be quite decisive for the outcome. However, that is a result of a player's understanding of the game's feedback structures as a whole, and as such it is **not an element that can or needs to be modeled within the structure**." (p.89-90)

この主張には再検討の余地がある。人間の振る舞いも**確率・分岐・パラメータ**に分解すれば、同じフレームワーク内で十分にモデル化できる。

---

## 2. 核心的洞察: 全ての非決定性は分解可能

### 原理

```
非決定的要素 = 確率分岐（Gate） × 状況依存（State Connection） × パラメータ（Register）
```

どんな人間的要素も、以下の3要素の組み合わせに分解できる：

1. **Gate（確率分岐）** — 成功/失敗の確率
2. **State Connection（状態依存）** — ゲーム状態が確率や効果量を変化させる
3. **Register（パラメータ）** — スキル値・戦略傾向・読み合い精度を数値化

これらは全てMachinationsフレームワークに既存の要素であり、新しいノードタイプや接続タイプは不要である。

---

## 3. パターン1: Player Skill（プレイヤースキル）

### 3.1 概念

プレイヤーの操作技量は、各行動における**成功確率**や**処理効率**として数値化できる。

**例: テトリスのブロック消去**

- ブロックはランダム（D6）に落下する（外部要因）
- プレイヤーの消去速度がスキルに依存する（スキル要因）
- フィールドが溢れるとゲームオーバー（終了条件）

### 3.2 Machinationsダイアグラム

```
                    ┌─────────────┐
                    │  Register   │
                    │  スキル = 5  │
                    └──────┬──────┘
                           │ State Connection
                           │ [nodeModifier: self]
                           ▼
┌──────────┐    ┌──────────────┐    ┌──────────────┐
│  Source   │───▶│    Pool      │───▶│    Drain     │
│ブロック落下│ D6 │ フィールド    │    │ ライン消去    │
│  (auto)  │    │ start:5      │    │ consumption  │
│          │    │ capacity:20  │    │ = スキル値    │
└──────────┘    └──────┬───────┘    └──────────────┘
                       │
                       │ {フィールド} >= 20
                       ▼
                ┌──────────────┐
                │End Condition │
                │  GAME OVER   │
                └──────────────┘
```

### 3.3 動作原理

| スキル値 | 消去速度 | D6平均流入 | 純増減/step | 結果 |
|---------|---------|-----------|-----------|------|
| 2 | 2/step | 3.5/step | +1.5 | ~13stepでゲームオーバー |
| 3 | 3/step | 3.5/step | +0.5 | ~30stepで限界（不安定） |
| 4 | 4/step | 3.5/step | -0.5 | 安定（やや余裕あり） |
| 6 | 6/step | 3.5/step | -2.5 | 余裕で生存 |

### 3.4 分析手法

1. Register「スキル」の値を変更（2, 3, 4, 5, 6, 7, 8）
2. 各値でMonte Carlo実行（100回 × 50ステップ）
3. 生存率（フィールド < 20 で終了しなかった割合）を比較
4. **スキル閾値**（生存率50%のスキル値）を特定 → ゲームバランスの指標

### 3.5 拡張パターン

```
                    ┌──────────┐
                    │ Register │
                    │ スキル=5  │
                    └────┬─────┘
                         │
              ┌──────────┼──────────┐
              ▼          ▼          ▼
         Gate(障害物1) Gate(障害物2) Gate(障害物3)
         成功率:70%   成功率:50%   成功率:30%
              │          │          │
         失敗→ロス-3  失敗→ロス-5  失敗→ロス-10
```

スキルをGateの成功確率に反映させ、複数の障害物を直列に配置する。
各障害物の難易度（失敗時ペナルティ）を変えることで、
スキルレベルごとの突破確率を精密にモデル化できる。

---

## 4. パターン2: Meta-dynamic（メタダイナミクス）

### 4.1 概念

Meta-dynamicは、プレイヤーの**戦術的・戦略的判断**がゲームのフィードバック構造に影響を与える現象である。

**例: RTSの攻守投資バランス**

有限のリソースを「攻撃」と「防御」にどう配分するかという戦略的判断が、
ゲーム全体の動態を決定する。

### 4.2 Machinationsダイアグラム

```
┌─────────────────┐
│    Register     │
│ 攻撃偏重度 = 7   │───────────────────────────────────┐
│  (0～10)        │                                   │
└────────┬────────┘                                   │
         │                                            │
         │ [nodeModifier: self]         [nodeModifier: 10 - self]
         ▼                                            ▼
┌──────────────┐    ┌──────────┐    ┌──────────────┐    ┌──────────┐
│   Source     │───▶│   Pool   │    │   Source     │───▶│   Pool   │
│  攻撃投資    │ 7  │  攻撃力   │    │  防御投資    │ 3  │  防御力   │
│  (auto)     │    │          │    │  (auto)     │    │          │
└──────────────┘    └────┬─────┘    └──────────────┘    └────┬─────┘
                         │                                   │
    [nodeModifier:       │              [nodeModifier:       │
     self * 0.3]         │          Math.max(1,5-self*0.15)] │
                         ▼                                   ▼
                  ┌──────────────┐                    ┌──────────────┐
┌──────────┐     │    Drain     │    ┌──────────┐    │   Source     │
│   Pool   │────▶│   敵損耗     │    │   Pool   │◀───│  敵の攻撃    │
│  敵HP:30 │     │             │    │ 被害蓄積  │    │  (auto)     │
└──────────┘     └──────────────┘    └──────────┘    └──────────────┘
         │                                   │
         └──── End Condition ────────────────┘
              敵HP<=0(勝利) or 被害>=30(敗北)
```

### 4.3 戦略空間の分析

| 攻撃偏重度 | 攻撃投資 | 防御投資 | 戦略タイプ | 予想される結果 |
|-----------|---------|---------|-----------|-------------|
| 9 | 9/step | 1/step | 超攻撃的 | 短期決戦。勝つか被害で倒れるか |
| 7 | 7/step | 3/step | 攻撃寄り | 攻撃優位だが防御不足リスク |
| 5 | 5/step | 5/step | バランス | 安定。長期戦向き |
| 3 | 3/step | 7/step | 防御寄り | 被害は抑えるが敵を倒せない |
| 1 | 1/step | 9/step | 超防御的 | 生存するが勝利困難 |

### 4.4 分析手法

1. 攻撃偏重度を1～9まで変えてMonte Carlo実行
2. 各値での「勝利率」「平均決着ステップ」を記録
3. **ナッシュ均衡点**（最適な攻守バランス）を特定
4. 敵の攻撃パラメータを変えた場合の最適戦略の変化を分析

### 4.5 2プレイヤー拡張

```
┌──────────┐                              ┌──────────┐
│ Register │                              │ Register │
│P1偏重度=7│                              │P2偏重度=4│
└────┬─────┘                              └────┬─────┘
     │                                         │
     ▼                                         ▼
 P1攻撃力 ──[damage]──▶ P2のHP        P2攻撃力 ──[damage]──▶ P1のHP
 P1防御力 ──[reduce]──▶ P2の攻撃効果  P2防御力 ──[reduce]──▶ P1の攻撃効果
```

両プレイヤーの戦略パラメータの**組み合わせ**がゲーム結果を決定する。
Monte Carloで全組み合わせを分析すれば、ペイオフマトリクスを構築できる。

---

## 5. パターン3: Multiplayer-dynamic（マルチプレイヤーダイナミクス）

### 5.1 概念

Multiplayer-dynamicは、プレイヤー間の**直接的な相互作用**がフィードバックループに影響する現象である。

**例: 格闘ゲームの読み合い**

互いの行動を予測し合う「読み」の精度が、攻撃のダメージ効率を左右する。

### 5.2 Machinationsダイアグラム

```
 ┌──────────┐                              ┌──────────┐
 │ Register │                              │ Register │
 │P2読み力=5│                              │P1読み力=5│
 └────┬─────┘                              └────┬─────┘
      │                                        │
      │ [nodeModifier:                          │ [nodeModifier:
      │  D6 * self / 5]                         │  D6 * self / 5]
      │                                         │
      ▼                                         ▼
 ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
 │   Pool   │───▶│  Drain   │    │  Drain   │◀───│   Pool   │
 │ P1体力:30│    │ P1被弾   │    │ P2被弾   │    │ P2体力:30│
 └──────────┘    └──────────┘    └──────────┘    └──────────┘
      │                                               │
      └──────────── End Condition ────────────────────┘
                 P1体力<=0 or P2体力<=0 → KO
```

### 5.3 ダメージ計算式

```
P2へのダメージ/step = D6 × (P1読み力 / 5)
P1へのダメージ/step = D6 × (P2読み力 / 5)
```

| P1読み力 | P2読み力 | P1の平均ダメージ | P2の平均ダメージ | 有利側 |
|---------|---------|---------------|---------------|-------|
| 5 | 5 | 3.5 | 3.5 | 互角 |
| 8 | 5 | 5.6 | 3.5 | P1有利 |
| 5 | 8 | 3.5 | 5.6 | P2有利 |
| 8 | 3 | 5.6 | 2.1 | P1圧倒 |
| 3 | 8 | 2.1 | 5.6 | P2圧倒 |

### 5.4 分析手法

1. P1読み力とP2読み力の全組み合わせ（3×3 or 5×5）でMonte Carlo
2. 各組み合わせでの「P1勝率」を記録
3. **勝率マトリクス**を構築

```
              P2読み力
              3     5     7
P1読み力 3   50%   25%   10%
         5   75%   50%   30%
         7   90%   70%   50%
```

4. 読み力の差が勝率に与える影響を定量化
5. 「読み力+2で勝率がX%上昇」のような法則を発見

### 5.5 フィードバック拡張

読み合いにフィードバックを追加することで、より現実的なモデルになる：

```
P1体力(低下) ──[State Connection]──▶ P1読み力を低下
  (焦りによるミス増加: 負のフィードバック)

P1体力(低下) ──[State Connection]──▶ P1読み力を増加
  (集中力向上: 火事場の馬鹿力: 正のフィードバック)
```

どちらのフィードバックを採用するかで、ゲームの逆転可能性が変わる。

---

## 6. 統一的フレームワーク

### 6.1 3パターンの共通構造

全てのDeterminabilityパターンは同一の構造を持つ：

```
┌──────────────┐
│   Register   │  ← 非決定的要素をパラメータ化
│  (パラメータ) │
└──────┬───────┘
       │
       │ State Connection
       │ (nodeModifier / labelModifier)
       │
       ▼
┌──────────────┐
│  対象ノード   │  ← 影響を受けるフロー要素
│(Source/Drain/ │    (生産速度、消費速度、接続レート)
│ Gate/Connection)│
└──────────────┘
```

### 6.2 パターン対応表

| Determinability | パラメータの意味 | State Connectionの効果 | 分析手法 |
|----------------|---------------|---------------------|---------|
| **Player Skill** | 操作スキル値 | Drain消費速度を制御 | スキル帯ごとのMonte Carlo |
| **Meta-dynamic** | 戦略的傾向値 | 複数Sourceの生産比率を制御 | 戦略空間の網羅的分析 |
| **Multiplayer-dynamic** | 対人精度値 | 相手へのダメージ効率を制御 | 勝率マトリクスの構築 |

### 6.3 Dormansの分類との対応

```
Dormans (2012)                    本手法
─────────────────────────────────────────────────
Deterministic  (なし)      →  そのまま（変更なし）
Random         🎲          →  そのまま（D6, Gate）
Player Skill   👤 注釈     →  Register + nodeModifier → Drain/Source
Meta-dynamic   ♟ 注釈     →  Register + nodeModifier → 複数Source
Multiplayer    👥 注釈     →  Register × 2 + nodeModifier → 相互Drain
```

---

## 7. 実践ガイド

### 7.1 既存ダイアグラムへの適用手順

1. **特定**: ダイアグラム内で「人間の判断に依存する」フローを特定
2. **分解**: そのフローの結果を左右する要因を列挙
3. **パラメータ化**: 各要因にRegisterノードを割り当て、数値範囲を設定
4. **接続**: RegisterからState Connectionを対象ノード/接続に引く
5. **数式定義**: formulaに影響の関係式を記述（例: `self * 0.3`, `D6 * self / 5`）
6. **検証**: Monte Carloでパラメータ値を変えながら結果を比較

### 7.2 formula設計の指針

| 関係 | formula例 | 効果 |
|------|----------|------|
| 線形比例 | `self` | パラメータ値がそのまま影響 |
| 係数付き | `self * 0.3` | 影響を0.3倍に抑制 |
| 逆比例 | `10 - self` | パラメータ増加で効果減少 |
| 下限付き | `Math.max(1, self - 3)` | 最低値1を保証 |
| ランダム混合 | `D6 * self / 5` | ランダム性 + パラメータ依存 |
| 段階的 | `self > 5 ? 3 : 1` | 閾値による切り替え |

### 7.3 Monte Carlo分析のベストプラクティス

- **実行回数**: 100回以上（統計的信頼性のため）
- **ステップ数**: ゲームの典型的な長さの1.5～2倍
- **パラメータ範囲**: 最低5段階（例: 1, 3, 5, 7, 9）
- **記録項目**: 終了ステップ、各Pool最終値、EndCondition到達有無
- **可視化**: スキル値 vs 生存率のグラフ、勝率マトリクス

---

## 8. 学術的位置づけ

### 8.1 先行研究との関係

- **Dormans (2012)**: Machinationsフレームワークを定義。Determinabilityを5分類するが、3つは注釈に留める
- **LeBlanc (1999)**: フィードバックループの正/負の分類。マルチプレイヤーダイナミクスへの言及
- **Adams & Rollings (2007)**: ゲームバランスにおけるプレイヤースキルの議論
- **Salen & Zimmerman (2004)**: ゲームデザインにおける不確実性の役割

### 8.2 本手法の貢献

1. Dormansが注釈に留めた3つのDeterminabilityタイプを、**既存フレームワーク要素のみ**で具体化
2. 各パターンに対する**再利用可能なテンプレート**を提示
3. Monte Carlo分析による**定量的検証手法**を確立
4. オープンソースのWebシミュレーターで**再現可能な形**で実装

### 8.3 制約と今後の課題

- Gate の確率分布が均等分布に限定される（重み付き分配の実装が望ましい）
- 2プレイヤー以上の同時相互作用モデルは複雑になる
- 時間変化するパラメータ（学習効果、疲労）のモデル化
- 実ゲームのプレイデータとの照合による妥当性検証

---

## 参考文献

- Dormans, J. (2012). *Engineering Emergence: Applied Theory for Game Design*. Doctoral dissertation, University of Amsterdam.
- LeBlanc, M. (1999). *Tools for Creating Dramatic Game Dynamics*. In: The Game Design Reader (2006), pp. 438-459.
- Adams, E. & Rollings, A. (2007). *Fundamentals of Game Design*. Prentice Hall.
- Salen, K. & Zimmerman, E. (2004). *Rules of Play: Game Design Fundamentals*. MIT Press.

---

## 付録: サンプルダイアグラムの使用方法

### Machinations Web Simulator での実行

1. [デモサイト](https://dsgarage.github.io/machinations-web/) を開く
2. 「サンプル」→「決定性の具体化」カテゴリから選択
3. Register ノードを選択し、プロパティパネルで `value` を変更
4. 「▶ 実行」でシミュレーション開始
5. 下部チャートパネルでリアルタイム推移を確認
6. 「📊 統計」ボタンでMonte Carlo分析を実行
